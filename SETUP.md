# Руководство по установке и использованию Liana CRM

## Требования

- Node.js 18+ 
- npm или yarn
- Современный браузер (Chrome, Firefox, Safari, Edge)

## Установка

### 1. Клонирование репозитория
\`\`\`bash
git clone <repository-url>
cd liana-crm
\`\`\`

### 2. Установка зависимостей
\`\`\`bash
npm install
# или
yarn install
\`\`\`

### 3. Переменные окружения
Создайте файл `.env.local` в корне проекта:

\`\`\`env
# Аутентификация
AUTH_SECRET=your-secret-key-here
PASSWORD_SALT=your-password-salt-here

# GitHub синхронизация (опционально)
GITHUB_TOKEN=ghp_your_github_token_here
GITHUB_REPO=your-repo-name
GITHUB_OWNER=your-github-username

# База данных (опционально)
DATABASE_DIR=./data
DATABASE_PATH=./data/database.sqlite
\`\`\`

**Требуемые переменные:**
- `AUTH_SECRET` - Секретный ключ для аутентификации (минимум 32 символа)
- `PASSWORD_SALT` - Соль для хеширования паролей

**Опциональные переменные:**
- `GITHUB_TOKEN` - GitHub персональный токен доступа (для синхронизации БД)
- `GITHUB_REPO` - Название репозитория на GitHub
- `GITHUB_OWNER` - Имя пользователя на GitHub
- `DATABASE_DIR` - Директория для хранения БД (по умолчанию: `./data`)
- `DATABASE_PATH` - Полный путь к файлу БД (по умолчанию: `./data/database.sqlite`)

### 4. Запуск в режиме разработки
\`\`\`bash
npm run dev
# или
yarn dev
\`\`\`

Приложение будет доступно по адресу: http://localhost:3000

### 5. Сборка для production
\`\`\`bash
npm run build
npm run start
\`\`\`

## Настройка GitHub синхронизации

Для автоматического резервного копирования данных в GitHub:

1. **Создайте GitHub токен:**
   - Перейдите на https://github.com/settings/tokens
   - Нажмите "Generate new token (classic)"
   - Выберите права доступа: `repo` (полный контроль репозиториев)
   - Скопируйте токен в переменную `GITHUB_TOKEN`

2. **Укажите данные репозитория:**
   - `GITHUB_REPO` - название вашего приватного репозитория
   - `GITHUB_OWNER` - ваше имя пользователя на GitHub

3. **Используйте API:**
   - POST `/api/sync/github/backup` - Создать резервную копию в GitHub
   - POST `/api/sync/github/restore` - Восстановить БД из GitHub

## Первый запуск

### Вход в систему
- **Логин**: admin
- **Пароль**: admin123

### Начало работы
1. Перейдите на домашнюю страницу
2. Добавьте первого клиента (Клиенты → Добавить клиента)
3. Добавьте первый объект (Объекты → Добавить объект)
4. Запланируйте первый показ (Показы → Добавить показ)

## Основные функции

### Управление объектами
- Добавление, редактирование и удаление объектов
- Загрузка фотографий
- Добавление заметок и тегов
- Фильтрация и поиск
- Экспорт в CSV

### Управление клиентами
- Добавление и редактирование клиентов
- Отслеживание статуса звонков
- Добавление заметок
- Быстрое изменение статуса звонка (inline редактирование)
- Экспорт в CSV

### Планирование показов
- Визуальный календарь
- Добавление показов
- Уведомления о предстоящих показах
- Экспорт в CSV

### Аналитика
- Статистика на домашней странице
- Отчеты в HTML формате
- Отслеживание KPI
- Полная история действий администраторов (с IP адресами)

## Структура данных

### Объект недвижимости
\`\`\`typescript
{
  id: string                    // Уникальный ID
  address: string               // Адрес
  type: "apartment" | "house"   // Тип
  status: "available" | "reserved" | "sold"  // Статус
  price: number                 // Цена в гривнях
  area: number                  // Площадь в м²
  rooms?: number                // Количество комнат
  district?: string             // Район
  floor?: number                // Этаж
  totalFloors?: number          // Всего этажей
  owner: string                 // ФИО собственника
  ownerPhone: string            // Телефон собственника
  description?: string          // Описание
  inventory?: string            // Комплектация
  hasFurniture: boolean         // Есть ли мебель
  photos?: string[]             // Фотографии (base64)
  notes?: string                // Заметки
  tags?: string[]               // Теги
  createdAt: string             // Дата создания
}
\`\`\`

### Клиент
\`\`\`typescript
{
  id: string                    // 7-значный числовой ID
  name: string                  // ФИО
  phone: string                 // Телефон
  callStatus: "not_called" | "reached" | "not_reached"  // Статус звонка
  type: "buyer" | "seller" | "both"  // Тип клиента
  status: "active" | "inactive" | "completed"  // Статус
  budget?: string               // Бюджет
  notes?: string                // Заметки
  createdAt: string             // Дата создания
}
\`\`\`

### Показ
\`\`\`typescript
{
  id: string                    // Уникальный ID
  objectId: string              // ID объекта
  date: string                  // Дата (YYYY-MM-DD)
  time: string                  // Время (HH:MM)
  notes?: string                // Заметки
  createdAt: string             // Дата создания
}
\`\`\`

## Советы по использованию

### Оптимизация работы
1. Регулярно экспортируйте данные в CSV для резервной копии
2. Используйте GitHub синхронизацию для автоматического резервного копирования
3. Используйте теги для быстрой категоризации объектов
4. Добавляйте заметки о каждом переговоре
5. Планируйте показы заранее

### Лучшие практики
1. Используйте единообразный формат для адресов
2. Добавляйте фотографии для каждого объекта
3. Отслеживайте статус звонков клиентам
4. Регулярно обновляйте информацию об объектах
5. Проверяйте историю действий для аудита

## Решение проблем

### Данные не сохраняются
- Проверьте, что localStorage включен в браузере
- Очистите кэш браузера и перезагрузитесь
- Проверьте консоль браузера на ошибки

### Фотографии не загружаются
- Проверьте размер файла (не более 5MB)
- Используйте форматы JPG, PNG, GIF
- Проверьте свободное место в памяти браузера

### Фильтры не работают
- Перезагрузите страницу
- Очистите фильтры кнопкой "Сбросить"
- Проверьте консоль браузера на ошибки

### GitHub синхронизация не работает
- Проверьте, что `GITHUB_TOKEN` установлен правильно
- Убедитесь, что репозиторий существует и приватный
- Проверьте консоль на ошибки API GitHub
- Убедитесь, что у токена достаточно прав доступа

## Контакты и поддержка

Для вопросов и предложений обратитесь к разработчикам проекта.

## Лицензия

Этот проект распространяется под лицензией MIT.
